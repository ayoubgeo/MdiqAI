(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{58:function(e,t,s){Promise.resolve().then(s.bind(s,6911))},6911:function(e,t,s){"use strict";s.r(t);var a=s(7437),n=s(2265),r=s(7720),i=s.n(r),l=s(8165),c=s(6566);let o=e=>{let{text:t}=e;return(0,a.jsx)("div",{className:i().userMessage,children:t})},u=e=>{let{text:t}=e;return(0,a.jsx)("div",{className:i().assistantMessage,children:(0,a.jsx)(c.U,{children:t})})},h=e=>{let{text:t}=e;return(0,a.jsx)("div",{className:i().codeMessage,children:t.split("\n").map((e,t)=>(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"".concat(t+1,". ")}),e]},t))})},d=e=>{let{role:t,text:s}=e;switch(t){case"user":return(0,a.jsx)(o,{text:s});case"assistant":return(0,a.jsx)(u,{text:s});case"code":return(0,a.jsx)(h,{text:s});default:return null}};t.default=e=>{let{functionCallHandler:t=()=>Promise.resolve("")}=e,[s,r]=(0,n.useState)(""),[c,o]=(0,n.useState)([]),[u,h]=(0,n.useState)(!1),[m,f]=(0,n.useState)(""),p=(0,n.useRef)(null),_=()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{_()},[c]),(0,n.useEffect)(()=>{(async()=>{let e=await fetch("/api/assistants/threads",{method:"POST"});f((await e.json()).threadId)})()},[]);let x=async e=>{try{let t=await fetch("/api/assistants/threads/".concat(m,"/messages"),{method:"POST",body:JSON.stringify({content:e})}),s=l.c.fromReadableStream(t.body);v(s)}catch(e){h(!1)}},g=async(e,t,s)=>{for(let a=0;a<s;a++)try{return await e()}catch(e){if(a<s-1)await new Promise(e=>setTimeout(e,t));else throw e}},v=e=>{let t="",s=!1;b("assistant","Analyzing..."),e.on("textDelta",e=>{null!=e.value&&(t+=e.value,j(e.value),y(e.value)&&(s=!0)),null!=e.annotations&&N(e.annotations)}),e.on("imageFileDone",e=>{t+="\n![".concat(e.file_id,"](/api/files/").concat(e.file_id,")\n")}),e.on("event",e=>{"thread.run.completed"===e.event&&(s?setTimeout(()=>{w("assistant",t)},2e3):w("assistant",t))}),e.on("error",async t=>{j("\nAn error occurred while processing. Retrying...\n");try{await g(()=>v(e),2e3,3)}catch(e){j("\nFailed to process after multiple attempts.\n"),h(!1)}})},y=e=>e.split("\n").length>3||["function","const","let","import","export","class","return","if","else","for","while"].some(t=>e.includes(t)),j=e=>{o(t=>{let s=t[t.length-1],a={...s,text:s.text+e};return[...t.slice(0,-1),a]})},b=(e,t)=>{o(s=>[...s,{role:e,text:t}])},w=(e,t)=>{o(s=>{let a=s.slice(0,-1);return a.push({role:e,text:t}),a})},N=e=>{o(t=>{let s={...t[t.length-1]};return e.forEach(e=>{"file_path"===e.type&&(s.text=s.text.replaceAll(e.text,"/api/files/".concat(e.file_path.file_id)))}),[...t.slice(0,-1),s]})};return(0,a.jsxs)("div",{className:i().chatContainer,children:[(0,a.jsxs)("div",{className:i().messages,children:[c.map((e,t)=>(0,a.jsx)(d,{role:e.role,text:e.text},t)),(0,a.jsx)("div",{ref:p})]}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s.trim()&&(o(e=>[...e,{role:"user",text:s}]),r(""),_(),x(s).finally(()=>h(!1)))},className:"".concat(i().inputForm," ").concat(i().clearfix),children:[(0,a.jsx)("input",{type:"text",className:i().input,value:s,onChange:e=>r(e.target.value.slice(0,300)),placeholder:"Enter your question (max 300 characters)",disabled:u}),(0,a.jsx)("button",{type:"submit",className:i().button,disabled:u,children:"Send"})]})]})}},7720:function(e){e.exports={chatContainer:"chat_chatContainer__2c6Sy",inputForm:"chat_inputForm__Xq3TT",input:"chat_input__6Bt_Q",button:"chat_button__BRJVZ",messages:"chat_messages__0qVI1",userMessage:"chat_userMessage__ZvYaL",assistantMessage:"chat_assistantMessage__ulB1g",codeMessage:"chat_codeMessage__m2MVc"}}},function(e){e.O(0,[447,971,69,744],function(){return e(e.s=58)}),_N_E=e.O()}]);